<button class="btn btn-text tasks-component-toggle-btn"
    [class.shifted]="visible" [style.zIndex]="zIndex + 1"
    (click)="toggle()">Tasks</button>
<div class="container tasks-component" [style.zIndex]="zIndex" #container
    [class.visible]="visible"
    [class.resizing-enabled]="resizingEnabled"
    (click)="handleClickOnContainer()">
    <div class="task-form-container task-transition-target" *ngIf="temporaryTask; else elseBlock1">
        <form (submit)="createLabel($event)">
            <div class="task-form-label-input-container">
                <div class="task-form-color-picker-container" [style.backgroundColor]="formColor">
                    <input type="color" name="color" class="task-form-color-picker"
                        (input)="updateLabelColor($event)"
                        [value]="formColor">
                </div>
                <input type="text" name="title" class="input task-form-label-title-input"
                    placeholder="Label" autocomplete="off" required>
                <button class="btn">Create</button>
            </div>
            <p class="task-form-label-message" *ngIf="labelMessage">{{ labelMessage }}</p>
            <ul class="task-form-labels" *ngIf="formLabels.length">
                <li class="task-form-label" *ngFor="let label of formLabels">
                    <button type="button" class="btn btn-icon task-form-label-btn"
                        [title]="label.flagged ? 'Unselect label' : 'Select label'"
                        [class.flagged]="label.flagged" (click)="flagLabel(label)">
                        <div class="task-label-color" [style.backgroundColor]="label.color"></div>
                        <div class="task-label-title">{{ label.title }}</div>
                        <div class="checkbox-tick task-form-label-btn-tick"></div>
                    </button>
                </li>
            </ul>
        </form>
        <form class="task-form" (submit)="handleFormSubmit($event)">
            <textarea class="input task-input" name="text" [value]="temporaryTask.text"
                placeholder="Details" required></textarea>
            <button type="button" class="btn btn-icon subtask-add-btn" (click)="addSubtask()">
                <svg viewBox="0 0 24 24">
                    <use href="#plus"></use>
                </svg>
                <span>Add subtask</span>
            </button>
            <ul class="task-form-subtasks" *ngIf="temporaryTask.subtasks.length">
                <li class="task-form-subtask" *ngFor="let task of temporaryTask.subtasks; let i = index">
                    <input type="text" name="subtask" class="input" [value]="task.text" autocomplete="off">
                    <button type="button" class="btn btn-icon btn-icon-alt" (click)="removeTemporarySubtask(i)">
                        <svg viewBox="0 0 24 24">
                            <use href="#trash"></use>
                        </svg>
                    </button>
                </li>
            </ul>
            <div class="task-form-footer">
                <button type="button" class="btn btn-text" (click)="hideForm()">Cancel</button>
                <button type="submit" class="btn">Done</button>
            </div>
        </form>
    </div>
    <ng-template #elseBlock1>
        <div class="tasks-settings task-transition-target" *ngIf="settingsVisible else elseBlock2">
            <label class="checkbox-container tasks-settings-item">
                <input type="checkbox" class="sr-only checkbox-input"
                    [checked]="resizingEnabled"
                    (click)="toggleResizing()"
                    (keyup.enter)="toggleResizing()">
                <div class="checkbox">
                    <div class="checkbox-tick"></div>
                </div>
                <span>Enable resizing</span>
            </label>
            <div class="tasks-settings-footer">
                <button class="btn btn-text" (click)="hideSettings()">Done</button>
            </div>
        </div>
    </ng-template>
    <ng-template #elseBlock2>
        <div class="tasks-component-header task-transition-target">
            <button class="btn btn-icon task-add-btn" (click)="showForm()">
                <svg viewBox="0 0 24 24">
                    <use href="#plus"></use>
                </svg>
                <span>Add a task</span>
            </button>
            <div class="tasks-dropdown-container">
                <button class="btn btn-icon abs" (click)="toggleDropdown()" title="More">
                    <svg viewBox="0 0 24 24">
                        <use href="#vertical-dots"></use>
                    </svg>
                </button>
                <div class="container tasks-dropdown" *ngIf="dropdownVisible">
                    <button class="btn btn-icon tasks-dropdown-item" (click)="showSettings()">
                        <svg viewBox="0 0 24 24">
                            <use href="#settings"></use>
                        </svg>
                        <span>Settings</span>
                    </button>
                </div>
            </div>
        </div>
        <div class="tasks-main task-transition-target">
            <p class="task-notice" [class.dialog-visible]="tasksToRemove.length"
                *ngIf="!tasks.length || willBeEmpty; else elseBlock3">You have no tasks</p>
            <ng-template #elseBlock3>
                <ul class="tasks" [class.dialog-visible]="tasksToRemove.length"
                    cdkDropList (cdkDropListDropped)="drop($event)">
                    <li class="task" [class.removing]="task.removing" *ngFor="let task of tasks; let i = index" cdkDrag>
                        <div class="task-drag-placeholder" *cdkDragPlaceholder></div>
                        <div class="task-body">
                            <ul class="task-labels" *ngIf="task.labels.length">
                                <li class="task-label" *ngFor="let label of task.labels">
                                    <div class="task-label-color" [style.backgroundColor]="label.color"></div>
                                    <div class="task-label-title">{{ label.title }}</div>
                                </li>
                            </ul>
                            <div class="task-text-container" [class.has-labels]="task.labels.length">
                                <button class="checkbox task-checkbox-btn" title="Remove task"
                                    (click)="removeTask(i)" [disabled]="task.removing">
                                    <div class="checkbox-tick"></div>
                                </button>
                                <div class="task-text" [innerHTML]="task.displayText || task.text"></div>
                            </div>
                            <ul class="subtasks" *ngIf="task.subtasks.length">
                                <li class="subtask" [class.removing]="subtask.removing"
                                    *ngFor="let subtask of task.subtasks; let subtaskIndex = index">
                                    <div class="subtask-body">
                                        <button class="checkbox task-checkbox-btn" title="Mark Completed"
                                            (click)="removeSubtask(i, subtaskIndex)" [disabled]="subtask.removing">
                                            <div class="checkbox-tick"></div>
                                        </button>
                                        <span class="task-text" [innerHTML]="subtask.displayText || subtask.text"></span>
                                    </div>
                                </li>
                            </ul>
                            <button class="btn btn-icon btn-icon-alt task-edit-btn" title="Edit task"
                                (click)="editTask(i)" [disabled]="task.removing">
                                <svg class="task-edit-btn-icon" viewBox="0 0 24 24">
                                    <use href="#edit"></use>
                                </svg>
                            </button>
                        </div>
                    </li>
                </ul>
            </ng-template>
            <div class="tasks-dialog" *ngIf="removedTaskCount">
                <span>Removed <span class="tasks-dialog-task-count">{{ removedTaskCount }}</span> task{{ removedTaskCount > 1 ? "s" : "" }}</span>
                <button class="btn btn-text-alt tasks-dialog-btn" (click)="undoTaskRemoval()">UNDO</button>
            </div>
        </div>
    </ng-template>
    <resize-bar class="main-block-resize-bar" (pointerUp)="saveHeight($event)" *ngIf="resizingEnabled"></resize-bar>
</div>
